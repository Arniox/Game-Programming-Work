#include "ExplosionParticle.h"
#include <random>
#include <time.h>

ExplosionParticle::ExplosionParticle()
:dead(true)
,age(0)
,explosionRadius(0)
,randomAngle(0)
,R(0)
,dy(0)
,dx(0)
,vx(0)
,vy(0)
,gravity(0.0f)
{
	gravity = 3;
}
ExplosionParticle::~ExplosionParticle()
{
}

void 
ExplosionParticle::SetCenter(float x, float y)
{
	randomAngle = (rand() % 360);
	explosionRadius = (rand() % 300);
	max_age = (rand() % 20);
	R = degreesToRadians(randomAngle);
	dy = explosionRadius * cosf(R);
	dx = explosionRadius * sinf(R);
	
	float shift = 10;

	m_x = x + shift;
	m_y = y + shift;
}


void 
ExplosionParticle::Process(float deltaTime, int windowWidth, int windowHeight)
{
	age += deltaTime;
	//Kill if old
	if (age >= max_age) {
		dead = true;
	}

	//If bounce from floor (reduce speed by 20%)
	if (m_x >= windowWidth - 5 || m_x <= 5) {
		vx *= -0.80;
	}
	//If bounce from wall (reduce speed by 20%)
	if (m_y >= windowHeight - 5 || m_y <= 5) {
		vy *= -0.80;
	}

	//Move
	dy += gravity;
	vx += dx * deltaTime;
	vy += dy * deltaTime;
	m_x += vx * deltaTime;
	m_y += vy * deltaTime;

	
}